---
output:
  pdf_document: default
---

# Índice de abundancia relativa: `RAI`

### *Salvador Mandujano* {-}

## Introducción

Las cámaras-trampa son uno de los métodos más populares para obtener diferente información de la fauna, principalmente de mamíferos y aves de talla mediana y grande [@meek2013user; @mccallum2013changing; @burton2015wildlife]. En particular, con el fototrampeo es muy frecuente calcular el RAI [@bengsen2011using; @o2011abundance]. Por ejemplo, con ungulados [@rovero2009camera]; @gomez2016densidad], felinos [@bengsen2012estimating], lepóridos [@marchandeau2006abundance], entre algunos. 

En este capítulo se presenta la aplicación del paquete `RAI` desarrollado para estimar índices de abundancia relativa para diferentes especies mediante el foto-trampeo. En particular, en este capítulo se presenta paso a paso el procedimiento para estimar el RAI considerando dos modelos: 1) RAI tradicional o clásico; y 2) RAI alternativo que permite estimar la variación considerando los datos de cada cámara como replicas, y luego compararlos estadísticamente. Para este fin, se ejemplifica la aplicación de este paquete con un conjunto de datos obtenidos de 13 cámaras en una localidad de estudio en la Reserva de Biósfera Tehuacán-Cuicatlán en Oaxaca, México. Para detalles de este sitio se sugiere consultar los trabajos de @cruz2015riqueza, [@perez2018medium] y el blog: <http://venadosrbtc.blogspot.com>.

## Supuestos y limitantes del RAI

El cálculo e interpretación del RAI es relativamente simple: basado únicamente en el valor del índice se determina cuáles son las especies “más o menos abundantes”. Esta interpretación es cualitativa y subjetiva pero se reporta en la mayoría de los trabajos como una medida indirecta de la abundancia de cada especie. En muchos casos esta comparación carece de rigor estadístico por lo que las conclusiones deben tomarse con mucho cuidado. De manera general, estos son algunos de sus supuestos del RAI: 

1) Supone una relación lineal positiva entre la abundancia (N) de la población y el RAI.
2) Supone que para una misma especie el RAI se comporta similar en diferentes localidades y en diferentes estaciones del año.
3) Supone una constante o similar probabilidad de detección (temporal y espacialmente) para una misma especie y entre especies.
4) Supone que el RAI no es afectado por la ubicación espacial de las cámaras.

Adicionalmente, algunas de las limitantes del RAI son:

1) No calcula intervalos de confianza de manera que no se puede evaluar el poder estadístico para detectar cambios en las poblaciones.
2) Generalmente se calcula usando pocas cámaras lo cual puede sesgar la estimación, sobre todo si las cámaras no se colocan de manera aleatoria.
3) Frecuentemente el diseño de muestreo está hecho para una especie en particular, por ejemplo algún depredador, y luego se utilizan todos los datos de las especies obtenidas en las cámaras.
4) Es común poner las cámaras en los senderos y caminos; o bien en sitios seleccionados donde se sabe pasará el animal de interés. También es muy frecuente y discutible el empleo de atrayantes.

## Modelo RAI clásico o general

La manera más frecuente para estimar el RAI de cada especie es agrupando la información obtenida en todas las cámaras. Se define un periodo de tiempo en el cual se considera que las fotos de una misma especie son independientes. Habitualmente se emplean dos criterios: 60 min y 1440 min (24h) [@o2011abundance]. Una vez definido esto, se calcula el número de fotos independientes y se divide entre el total de tiempo de muestreo expresado como días o noche-trampa. Frecuentemente, la tasa obtenida se multiplica por 100 o bien por 1000 si el número de registros es demasiado bajo. 

Para calcular el RAI se usa la fórmula:

$$RAI_{i} = \frac{n_{tot}}{dias_{tot}} \times 100$$ 
**(Eq.1)**

donde: $n_{tot}$ es el número total de registros fotográficos independientes de la *i*-especie, $dias_{tot}$ es el esfuerzo de muestreo o número total de días, y 100 es el factor de corrección estándar. Es decir, el RAI simplemente es un índice que expresa el número promedio de fotos por cada 100 días de muestreo. Asume que a mayor valor del RAI la abundancia de la especie es mayor, pero no lo expresa como número de individuos de la población sino simplemente como un índice [@o2011abundance].

## Modelo RAI alternativo

Al no considerar la ubicación espacial de las cámaras ni las fotos específicas obtenidas en cada una, en el RAI clásico se pierde información relevante relacionada con la distribución espacial de las especies en el área de estudio. Esto se debe a que en el RAI clásico (**Eq.1**) se agrupa la información de todas las cámaras, por lo que no es evidente si la especie fue fotografiada en la mayoría o todas las camáras, o si la información proviene solo de algunas cámaras. Para ejemplificar, en la Figura \@ref(fig:g1) se muestra el mapa de la localización de varias cámaras en un sitio de estudio [@perez2018medium]. Se muestra información del número de fotos obtenidas para diferentes especies. Es interesante notar la heterogeneidad en la distribución y número de fotos obtenidas de diferentes especies en cada cámara. 

```{r g1, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center', fig.cap= "Distribución de especies fotografiadas en diferentes cámaras-trampa en Cuicatlán, Oaxaca. Basado en Pérez-Solano et al. (2018)."}
library(imager)
par(mfrow = c(1,1), mar= c(1,1,1,1)) 
x <- load.image("Figura 8.1. MapaRAI.png")
plot(x, axes = F)
```

Una estadístico alternativo al RAI y que está relacionado con la distribución, es el que se conoce como “ocupación”. Hay modelos para estimar este parámetro, pero uno de los más sencillos es la propoción de sitios ocupados también conocida como “ocupación naive” o bien PAO. Una alternativa más robusta es emplear los modelos que estiman la probabilidad de ocupación.

Una manera muy sencilla de comparar estadísticamente el RAI entre especies en una misma localidad, o de la misma especie en diferentes estaciones y/o localidades diferentes, es calculando el RAI por cámara. Es decir, sin agrupar los datos de todas las cámaras. La fórmula para este caso es:

$$RAI_{ij} = \frac{n_j}{dias_j} \times 100$$ 
**(Eq.2)**

donde: el subíndicie *i* se refiere a cada especie y el subíndice *j* a cada cámara-trampa. Por lo tanto, la **Eq.2** calcula no solo el promedio (el cual sigue siendo el mismo al obtenido en la **Eq.1**) sino además permite estimar alguna medida de la variación, como por ejemplo la desviación o el error estándar lo cual es relevante para comprobar estadísticamente posibles diferencias significativas. 

## Descripción del paquete `RAI`

El paquete está integrado con 12 funciones que sirven para calcular los índices y generar cuadros de resultados, gráficos y análisis estadísticos. El paquete se puede decargar desde: <https://rpubs/SMR8810/RAI.html> o alternativamente copiar el código completo del paquete y el código para ejecutarlo (**Anexos**). De manera muy resumida, el paquete `RAI` consiste de cuatro pasos sencillos:

```
#####################################################
# PASO 1
# Cargar el paquete:
source("RAI.R")
# -----------------------

# PASO 2 
# Leer datos de fototrampeo:
wildlife.data <- read.csv("mamiferos.csv", header = T)
# Leer datos de covariables hábitat:
habitat.data <- read.csv("habitat.csv", header = T)´
# Seleccionar las especies para graficar fotos por cámara, 
por ejemplo:
especie <- c("Odo_vir", "Uro_cin", "Can_lat", "Con_leu", 
"Did_vir", "Lyn_ruf")
# -----------------------

# PASO 3
# seleccionar funciones del paquete:
RAIgral() # modelo clásico
RAIalt() # modelo alternativo
Dist_spp() # grafica fotos por cámara y PAO especies 
OccNaive() # proporción de sitios ocupados
RAIaov() # ANOVA 
RAItukey() # prueba post hoc Tukey
RAIhsd() # prueba post hoc HSD
RAIglm() # modelo GLM tipo Poisson
RAIglmCov() # modelo GLM tipo Poisson con covariables
RAIcorr() # gráfica comparación RAIs
RAIinterp() # interpolación de distribución y abundancia
RAIfinal() # tabla de resultados finales
# -----------------------

# PASO 4: Compilación de documento 
#library(rmarkdown)
#rmarkdown::render("rai1.R", "pdf_document")

#########################################################

```

## Ejemplo de aplicación del paquete

Para ejemplificar el empleo de este paquete, se utilizará un conjunto de datos de 13 especies obtenidos de 13 cámaras en una localidad de estudio en la Reserva de Biósfera Tehuacán-Cuicatlán en Oaxaca, México [@perez2018medium]. Para este fin, se sugiere descargar del sitio <http://RAI> los siguientes tres archivos: `mamiferos.csv`, `habitat.csv` y `pkgRAI_1.R`. Los primeros dos son datos del ejemplo del foto-trampeo y covariables, respectivamente; mientras que el tercero es el paquete `RAI` el cual no requiere instalación. Sin embargo, para su correcta ejecuación se debe cargar primero empleando la función `source`. 

Se sugiere generar un proyecto dentro de `RStudio` y albergar en el mismo estos tres archivos. Los proyectos son una manera muy sencilla y eficaz de organizar y almacener los resultados (gráficos, tablas y otros) generados con este paquete. 

### Cargar el paquete

```{r echo=TRUE, message=FALSE, warning=FALSE}
source("pkgRAI_1.R")
```

### Datos de campo

Se sugiere emplear Excel para capturar los datos del foto-trampeo. Esta tabla debe contener 4 columnas cada una con los siguientes nombres: `Camera`, `Species`, `Events` y `Effort`; que corresponden a la cámara-trampa, especie, número de fotos-independientes y número de días de muestreo, respectivamente. **Es muy importante que los nombres de las columnas sean exactamente como aquí se muestran de lo contrario el paquete no funcionará**. Una vez capturados los datos se deben guardar como  archivo tipo `.csv`. Luego en R o `RStudio` se carga el archivo de datos como:

```{r echo=TRUE, message=FALSE, warning=FALSE}
wildlife.data <- read.csv("mamiferos.csv", header = T)
```

Tambien es muy importante que el nombre del objeto sea excamente llamado `wildlife.data`. En este ejemplo específico, los datos están constituidos por el registro de 13 especies de mamíferos medianos y grandes en 13 cámaras trampa durante 250 y 281 días de muestreo en el sitio de estudio (Cuadro \@ref(tab:tab1)). En R se puede emplear la función `View(wildlife.data)` para observar los datos.

```{r tab1,  echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
library(kableExtra)
library(xtable)
knitr::kable(head(wildlife.data, 30), caption = "Datos básicos por especie del número de registros independientes y esfuerzo de muestreo en cada cámara. Aquí se presentan solo los primeros 30 renglones de un total de 117.")
```

Además de los datos de fotos de las especies en las cámaras, con el paquete `RAI` es posible incoporar otros datos o covariables en los análisis, como:

```{r echo=TRUE, message=FALSE, warning=FALSE}
habitat.data <- read.csv("habitat.csv", header = T) 
```

Esta segunda matriz contiene los datos de UTMs y covariables de hábitat para cada una de las cámaras (Cuadro \@ref(tab:tab2)). 

```{r tab2, echo=FALSE, message=FALSE, warning=FALSE}
knitr::kable(habitat.data, caption = "Datos de UTMs y covariables asociados a cada cámara-trampa. Abreviaciones: distancia a la localidad más cercana") %>% kable_styling(font_size = 5)
```

```{r, message=FALSE, warning=FALSE, include=FALSE}
new.mat <- merge(x = wildlife.data, y = habitat.data, by = "Camera", all = TRUE)
```

### Modelo general

A partir de los datos de la Cuadro \@ref(tab:tab1) y ejectuando la función `RAIgral()`, se cálcula el RAI clásico para cada especie de acuerdo a la **Eq.1** y el paquete genera los resultados automáticamente (Cuadro \@ref(tab:tab3)). A partir de estos resultados en la mayoría de los trabajos se podría concluir que las especies más abundates (mayor RAI) son: *U. cinereoargentus*, *O. virginianus* y *C. latrans*; y todas las demás tiene baja abundancia. Sin embargo, esta conclusión es subjetiva ya que no se basa en ninguna prueba estadística que permita objetivamente sustentar cuáles especies tuvieron RAI distinto y significativo. 

```{r tab3, echo=FALSE, message=FALSE, warning=FALSE}
Tot_cameras <- with(new.mat, length(unique(Camera))) 
  cameras <- with(new.mat, tapply(Camera, Species, length)) 
  days <- with(new.mat, tapply(Effort, Species, sum))   
  n <- with(new.mat, tapply(Events, Species, sum))   
  
  occ <- subset(new.mat, new.mat$Events > 0)
  OccNaive <- as.data.frame(round(table(occ$Species)/cameras,2))

  RAIgral <- round(n/days*100, 2) 
  table.1 <- cbind(cameras, days, n, RAIgral, OccNaive = OccNaive[,2])
  table.1 <- table.1[order(RAIgral),]
  
knitr::kable(table.1, caption = "Estimaciones del índice de abundancia relativa (RAI) y ocupación naive (OccNaive) estimados para cada una de las especies.")
```

### Ocupación naive y distribución de especies/cámara

La proporción de sitios ocupados frecuentemente llamada "ocupación naive", es una medida simple de la distribución de cada especie en el sitio de estudio. Se cálcula como el porcentaje de cámaras donde aparaece la especie de interés. En el paquete `RAI` esto se calcula autmáticamente. Por ejemplo, se obtiene que *U. cinereoargenteus* tiene una ocupación de 1.0 (100 \%) mientras que *C. latrans* de 0.33 (33 \%).

Además, resulta ilustrativo visualizar la distribución de las especies en el sitio de estudio. Esto permite conocer si los datos de fotografías provienen de todas o solo de algunas cámaras. Para esto, el paquete RAI ofrece la oportunidad de seleccionar las especies que se quieren graficar. Por ejemplo aquí se seleccionan cuatro especies:

```{r echo=TRUE, message=FALSE, warning=FALSE}
especie <- c("Uro_cin", "Can_lat") 
```

Nuevamente, es importante que no se modifique el nombre del objeto, es decir `especie`. Ejecutando la función `Dist_spp( )` se obtiene los gráficos mostrados en la Figura \@ref(fig:g2). En este ejemplo es evidente que *Urocyon cinereoargentus* tiene más amplia distribución y abundancia relativa; mientras que *Canis latrans* aparece en pocas cámaras, aunque con un número grande de fotos en una de ellas. Esto tiene como consecuencia que el RAI de esta especie sea alto.

```{r g2, echo=FALSE, message=FALSE, warning=FALSE, out.width="100%", fig.cap= "Ejemplo de distribución de especies en las cámaras. El número dentro de cada círculo representa el número de fotos. La escala de los ejes está en UTMs."}
par(mfcol = c(1,2)) 
  for (i in 1:length(especie)) {
    sp  <- subset(new.mat, Species == especie[i])
    plot(sp$X, sp$Y, xlab="UTM", ylab="UTM", frame.plot = F, cex.axis = 0.5,  main = unique(sp$Species), type = "n", labels = T, ylim = c(min(sp$Y - 1000), max(sp$Y + 1000)))
    points(sp$X, sp$Y, pch = 16, col = "skyblue", cex = 4)
    text(sp$X, sp$Y, sp$Events) 
  }
```

### Modelo alternativo

Para calcular el RAI de acuerdo a la **Eq.2** en la que se obtiene un índice por especie para cada cámara, simplemente se ejecuta la función `RAIalt()` y se obtiene automáticamente (Cuadro \@ref(tab:tab4)).

```{r tab4, echo=FALSE, message=FALSE, warning=FALSE}
RAIalt <- with(new.mat, round((Events/Effort)*100, 2))
table.2 <- cbind(new.mat, RAIalt)

knitr::kable(head(table.2[-5:-11], 15), caption = "Matriz de datos con las estimaciones RAI para cada una de las especies. Observe que el RAI es calculado para cada una de las cámaras basado en el número de fotos independientes (en este ejemplo cada 24 h) y el número de días que estuvo activa cada cámara. Aquí se presentan solo los primeros 15 renglones de un total de 117. Además para fines de presentación se han eliminado algunas columnas.")
```

Gráficamente estos resultados se muestran en la Figura \@ref(fig:g4). Atendiendo únicamente al promedio las especies con mayor RAI son: *O. virginianus* y *U. cinereoargenteus*, seguidas de *C. latrans*, *L. rufus* y *N. narica*; mientras que el resto de las especies podrían ser las menos abundantes. Sin embargo, observe las líneas verticales que indican la variación (en este caso desviación estándar) del RAI. Esto se debe a que el RAI se estimó por cámara para cada especie de acuerdo a la **Eq.2**. 

```{r g4, echo=FALSE, message=FALSE, warning=FALSE, fig.height= 4, fig.cap= "Estimación del índice de abundancia relativa (RAI) para cada especie."}
par(mfcol = c(1,1), mar = c(5,5,1,1))
boxplot(RAIalt ~ Species, data = new.mat, ylab = "RAI", varwidth = F, outline = F, cex = 3.4, las = 2, frame.plot = FALSE, cex.axis = .7, col = "skyblue")
```

### Comparación estadística entre especies

Para conocer si hay diferencias se puede contrastar estadísticamente los RAI de las especies mediante un análisis de varianza de una vía especificado en R como `lm(RAI ~ Especie)`. Para este fin, la ejecuación del ANOVA se realiza con la función `RAIaov()`.

```{r, echo=FALSE, message=FALSE, warning=FALSE, results= "asis"}
RAIaov <- aov(RAIalt ~ Species-1, data = new.mat)
(mod <- summary(RAIaov))
#xtable(mod, caption = "Análisis de varianza para comparar el RAI entre especies.")
#print.xtable(t, type = "latex", caption.placement = "top")
```

#### Comparación posterior: prueba HSD

Alternativamente, se puede generar un gráfico empleando, por ejemplo el paquete R llamado `agricolae`; luego se ejecuta la función `RAIhsd()` y se obtiene la Figura \@ref(fig:g7). En este gráfico las letras encima de las barras indican el resultado de la prueba *a posteriori* HSD. Letras similares indican que no existe diferencia entre esas especies (P > 0.05); letras diferentes que sí hay diferencias (P < 0.05). De acuerdo a esto, las dos especies con el RAI mayor fueron *O. virginianus* y *U. cinereoargenteus* (letra "a") y significativamente diferente a las demás (letra "b"). Note que *C. latrans* con un RAI alto, resultó estadísticamente no significativo con el venado y la zorra, pero tampoco con las demás especies con menor RAI. En el caso del coyote esto se debe a que la mayoría de las fotos se detectaron en ua sola cámara, muy probablmente del mismo o pocos individuos.

```{r g7, echo=FALSE, message=FALSE, warning=FALSE, fig.cap= "Comparación posterior de la prueba de HSD."}
  library(agricolae)
  out_1 <- HSD.test(RAIaov, "Species")
  out2 <- out_1$groups
  par(mfcol = c(1,1), mar = c(5,5,1,1))
  bar.group(out_1$groups , horiz = F, las = 2, cex.main = 2, font = 3, cex.axis = 0.9, plot = T, col = "lightblue", ylim = c(0, max(RAIgral + 2)), names.arg = out_1$trt, ylab = "RAI")
```

## Tabla general de resultados

El paquete RAI tiene la función `RAIfinal()` la cual genera el Cuadro \@ref(tab:tab5)  con los resultados del RAI obtenidos para cada especie y modelo.

```{r tab5, echo=FALSE, message=FALSE, warning=FALSE}
RAImean <- with(new.mat, round(tapply(RAIalt, Species, mean), 2))
RAIsd <- with(new.mat, round(tapply(RAIalt, Species, sd), 2))
occ <- subset(table.2, table.2$Events > 0)
OccNaive <- round(table(occ$Species)/cameras,2)

table.3 <- cbind(cameras, days, n, RAIgral, RAImean, RAIsd, OccNaive)
table.3 <- table.3[order(RAIgral),]

knitr::kable(table.3, caption = "Resumen final de los resultados de los RAI obtenidos con los diferentes modelos para cada especie en la localidad de estudio.", digits = 2) %>% kable_styling(font_size = 7)
```

## Importancia de la probabilidad de detección

De manera implícita el RAI se basa en un supuesto débil: la probabilidad de detección es la misma para todas las especies, o para la misma especie en diferentes épocas del año y localidades. Es decir, la probabilidad de detección no es considerada en la estimación del RAI. De manera implícita el RAI asume estos supuestos:

1) Los valores de 0 indican ausencia real de la especie; es decir, la probabilidad de detección es exactamente igual a 1.
2) Entre especies, la probabilidad de detección es la misma para todas.
3) Para una misma especie, la probalidad de detección es la misma entre tipos de hábitats y entre temporadas del año.

A partir de la experiencia en el trabajo de campo, se sabe que un 0 no significa necesariamente que la especie no está presente. Es posible que la especie habite la localidad de estudio y sin embargo no fue fotografiada o detectada en las cámaras. Esto es lo que se conoce como falso negativo o un falso cero [@mackenzie2006occupancy]. Los RAI no están diseñados para estimar ni incorporar los falsos negativos.

Para este fin afortunadamente existe otra familia de modelos los cuales estiman tanto la probabilidad de detección como la de ocupación [@mackenzie2006occupancy]. Estos modelos son más robustos que los RAI pero requieren de comprender el enfoque jerárquico de análisis en ecología [@kery2015applied]. El programa PRESENCE [@hines2006program] y el paquete R `unmarked` [@fiske2011], abordan este aspecto con mayor profundidad y solidez analítica este tipo de modelos. 

## Sumario

En este capítulo se presentan diferentes modelos para estimar el índice de abundancia relativa (RAI). El proceso descrito permite de manera muy sencilla mejorar la interpretación y conclusiones del RAI basado en criterios estadísticos sencillos, pero más robusto. Sin embargo, este proceso no soluciona el punto más crítico y controversial de los RAI: el supuesto falso de que la probabilidad de detección es similar para una misma especie entre hábitats y periodos, y entre diferentes especies en una misma localidad. La sugerencia es por lo menos calcular el llamado índice de ocupación naive o proporción de sitios ocupados (PAO) el cual provee de información espacial elemental en la variación de la abundancia de cada especie en el sitio de estudio. Alternativamente, con el foto-trampeo se pueden emplear otros modelos con mayor sustento teórico: modelos de ocupación, modelos N-mixtos, modelos de captura-recaptura simples o espacialmente explícitos [@royle2008hierarchical; @royle2013spatial; @kery2015applied]. Lo único que se requiere es conocer estos modelos opcionales, ya que la base de información se tiene con el mismo foto-trampeo. Simplemente se debe organizar los datos de otra manera (nada complicada) y considerar además la ubicación espacial de cada cámara. 
