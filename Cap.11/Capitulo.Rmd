
# Uso de bebederos: `ggplot2`, `agricolae` y `effects`

### *Carlos Hernández-Gomez* {-}

## Introducción

Los animales pueden hacer uso del hábitat de distintas maneras, por ejemplo pueden visitar diversos puntos dentro del hábitat para realizar actividades específicas, como alimentarse de frutos caidos [@Raices2017] o del nectar de algunas plantas, recurrir a fuentes de agua naturales o artificiales para beber y darse baños [@Delgado-Martinez2017], estos puntos pueden ser localizados en campo y ser monitoreados a través del fototrampeo, herramienta que nos permite monitorear en todo momento los puntos y observar las visitas que hacen los organismos. Una manera de cuantificar dichas visitas es mediante el uso de una tasa de visita. Al utilizar esta herramienta podemos cuantificar y comparar el uso que se le da a los puntos medido a través de las visitas que se realizan.  

En este capítulo se presenta una tasa de visita util para cuantificar el uso de los mamíferos a diversos puntos en el hábitat, así como diversas gráficas descriptivas y análisis estadísticos. En este caso se ejemplificara la aplicación de la tasa de visita con registros de visitas a bebederos artificiales en una Reserva de la Biosfera.

## Cálculo de la tasa de visita

La tasa de visita empleada en este capítulo es la siguiente:

$$Tasa\_visita_{ij}=\frac{n}{Esfuerzo}\times 100$$

en donde: ${n}$ representa el número de visitas independientes para cada ${i}$ especie en cada ${j}$ punto (bebedero, árbol, u otro), el ${Esfuerzo}$ representa el número de días que se mantuvo activa la cámara trampa y 100 corresponde al coeficiente de corrección, se añade el coeficiente de corrección para hacer la tasa comparable con otras ya que nos indica la tasa de visitas por cada 100 días. Al calcular la tasa de visita para cada punto es posible obtener un promedio de las tasas y por consiguiente realizar análisis que den peso estadístico a nuestros resultados.

Lo primero que se necesita para calcular la tasa de visita es organizar los datos en una base de datos. Mediante algunos paquetes como `camtrapR` (ver Capítulo 3) se puede obtener la base de datos de los registros independientes para cada especie (Figura \@ref(fig:h1)).

```{r h1, echo=FALSE, message=FALSE, warning=FALSE, fig.align = 'center', fig.cap= "Base de datos generada mediante camtrapR.", out.width="99%"}
library(imager)
F1 <- load.image('figura.1.png')
plot(F1, axes = F)
```

A partir de esta base de datos se extraen las especies a las que se les va a calcular la tasa de visita, las estacioness monitoreadas, el número de visitas obtenidas para cada especie en cada estación y el número de días que se mantuvo en operación cada cámara. Así mismo es conveniente agregar una columna que represente las temporadas o años muestreados así como los diversos puntos a evaluar. 

Una vez obtenida la base de datos se carga en R:

```{r, message=FALSE, warning=FALSE}
datos <- read.csv("datos.csv", header = TRUE)
```

Una vez cargados los datos se procede a calcular la tasa de visitas como se muestra a continuación:

```{r echo=TRUE, message=FALSE, warning=FALSE}
Tasa_visitas <- with(datos, round((Eventos/Esfuerzo)*100,
                                 2))
```

La cual contiene los datos mostrados en el Cuadro \@ref(tab:h2). Si se desea se puede guardar la tasa en un archivo .csv mediante la función:

```
#write.csv(tabla, "datos_2.csv")
```

```{r h2, message=FALSE, warning=FALSE, echo=FALSE, fig.align='center', results='asis'}
library(kableExtra)
library(xtable)
tabla <- cbind(datos[-6], Tasa_visitas)
knitr::kable(head(tabla, 20), caption = "Datos de registros independientes para cada especie. En este ejemplo se muestran los primeros 20 renglones.") %>% 
kable_styling(font_size = 4.5)
```

El archivo `.csv` creado contiene ahora la tasa de visita calculada para cada especie en cada estación:

```{r echo=TRUE, message=FALSE, warning=FALSE}
datos_2 <- read.csv("datos_2.csv", header = TRUE)
```

## Gráficos tasa visita por especie y año

Una forma de visualizar los resultados es empleando el paquete `ggplot2`. Una manera de mostrar los datos es por especies agrupando las visitas a los bebederos en los diferentes años del estudio (Figura \@ref(fig:h3)). 

```{r h3, echo=TRUE, message=FALSE, warning=FALSE, fig.height= 8, fig.cap= "Estimación de la tasa de visita para cada especie agrupando por año."}
library(ggplot2)
ggplot(datos_2, aes(x = Especies , y = Tasa , 
        fill = factor(Año), color = factor(Año))) +
  geom_boxplot() +
  scale_fill_manual(values = c("green", "royalblue", 
                               "red")) +
  scale_color_manual(values = c("green4", "royalblue4", 
                                "red4")) +
  theme_bw() + 
  theme(panel.border = element_blank(), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "black")) +
  theme(legend.position =  c(0.1, 0.8))+
  ggtitle("") +
  theme(axis.text.x = element_text(angle = 90, 
                  face="bold.italic", hjust = 1, 
                  size=rel(1.7))) +
  theme(plot.title = element_text(hjust = 0.5, 
                  size = rel(2.5))) +
  labs(x = "", y = "Tasa de visitas") +
  labs(fill = "Año", color = "Año") +
  theme(axis.title.x = element_text(size = rel(1.75))) +
  theme(axis.title.y = element_text(size = rel(1.75))) +
  theme(legend.title = element_text(size = rel(1.75))) +
  theme(legend.text = element_text(size = rel(1.5)))
```

Alternativamente, se puede graficar la tasa de visita de cada especie para cada bebedero en los diferentes años (Figura \@ref(fig:h4)).

```{r h4, echo=TRUE, message=FALSE, warning=FALSE, fig.height=8, fig.cap="Tasa de visita de cada especie agrupada por bebedero."}
ggplot(datos_2, aes(fill = Especies, y = Tasa, 
                    x = Camara)) +
  geom_bar(stat = "identity") +
  facet_wrap(~ Año) +
  theme_bw() + 
  theme(panel.border = element_blank(), 
        panel.grid.major = element_blank(),
 panel.grid.minor = element_blank(), 
 axis.line = element_line(colour = "black")) +
  theme(legend.position =  "right") +
  ggtitle("") +
  theme(axis.text.x = element_text(angle = 90, 
              hjust = 1, size=rel(1.5))) +
  theme(plot.title = element_text(hjust = 0.5, 
                size=rel(2.5)))+
  labs(x = "Bebedero", y = "Tasa de visitas") +
  theme(axis.title.x = element_text(size = rel(1.75))) +
  theme(axis.title.y = element_text(size = rel(1.75))) +
  theme(legend.title = element_text(size = rel(1.5))) +
  theme(legend.text = element_text(face = "italic", 
                                   size = rel(1)))
```

## Análisis estadísticos

Al tratarse de datos de índices es posible usar pruebas de ANOVA para probar si hubo diferencia significativa en las tasas de visitas entre especies. Para esto se emplea la función `aov()` como:

```{r echo=TRUE, message=FALSE, warning=FALSE, linewidth=55}
anova <- with(datos_2, aov(Tasa ~ Especies))
summary(anova)
```

Si quisiera hacerse esta prueba para los datos unicamente de una temporada, lo único que se tiene que hacer es extraer los datos de dicha temporada como:

```{r echo=TRUE, message=FALSE, warning=FALSE, linewidth=55}
A_2018 <- datos_2[datos_2$Año == "2018",]

anova_18 <- with(A_2018, aov(Tasa ~ Especies))
summary(anova_18)
```
 
Siguiendo con este ejemplo, la prueba de ANOVA indica que hay diferencia significativa en al menos una especie, pero no nos indica de cuál se trata, para averiguar que especie es la que presenta una mayor tasa de visita se realiza una prueba *post hoc* HSD Tukey, esta prueba se hace a través del paquete `agricolae`[@agricolae2017] con la función `HSD.test` como:

```{r echo=TRUE, message=FALSE, warning=FALSE, linewidth=55}
library(agricolae)
out <- HSD.test(anova_18, "Especies", alpha = 0.05)
out$groups
```

Los resultados de esta prueba a posteriori se pueden visualizar gráficamente (Figura \@ref(fig:h5)).

```{r h5, echo=TRUE, message=FALSE, warning=FALSE, fig.height= 8, fig.cap="Prueba HSD Tukey para la tasa de visita por especie."}
out <- HSD.test(anova_18, "Especies", alpha = 0.05)
par(mfcol = c(1,1), mar = c(9,5,3,3))
bar.group(out$groups, horiz = F, las = 3, cex.main = 2, 
          font = 3, cex.axis = 0.9, plot = T, 
          col = "lightblue", ylim = c(0,60), 
          names.arg = out$trt, ylab = "Tasa de visitas", 
          main = "", cex.lab = 2)
```

## Análisis por especie

Alternativamente, se puede calcular la tasa de visita para una especie en particular extrayendo los datos únicamente de dicha especie, por ejemplo con el lince como:

```{r echo=TRUE, message=FALSE, warning=FALSE}
Lince <- datos_2[datos_2$Especies == "L. rufus",] 
```

Luego se pueden poner a prueba diferentes hipótesis, por ejemplo si la tasa de visitas de los linces varía entre años:

```{r echo=TRUE, message=FALSE, warning=FALSE}
anova_L.r1 <- with(Lince, aov(Tasa ~ Año))
summary(anova_L.r1)
```

o bien si la tasa de visita varía entre bebederos:

```{r echo=TRUE, message=FALSE, warning=FALSE}
anova_L.r3 <- with(Lince, aov(Tasa ~ Camara)) 
summary(anova_L.r3)
```

Por otro lado, si se quiere analizar una especie en particular en un año o temporada específica, por ejemplo el conejo en el 2014, se extraen los datos como:

```{r echo=TRUE, message=FALSE, warning=FALSE}
S.a_14 <- datos_2[datos_2$Especies == "S. angustifrons" 
                & datos_2$Año == "2014",]
```

## Análisis de variables relacionadas con la tasa de visita

Otro análisis interesante es determinar las variables ambientales o climáticas que están relacionadas con la tasa de visita. Para este fin se pueden emplear modelos lineales generalizadosS (GLMs). Para esto es necesario generar una historia de detecciones para cada estación (en este caso bebedero) en cada ocasión de muestreo. Como ejemplo, en la Figura \@ref(fig:h6) se presentan datos del venado cola blanca.

```{r h6, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center', fig.cap="Historia de captura para venado cola blanca.", out.width="99%"}
F1 <- load.image('figura.3.png')
plot(F1, axes = F)
```

Una vez teniendo esta tabla se procede a asociar a cada ocasión de muestreo las variables correspondientes (Cuadro \@ref(tab:h7)). 

```{r h7, echo=FALSE, message=FALSE, warning=FALSE}
Venado <-read.csv("Datos_venado.csv", header=TRUE)
knitr::kable(head(Venado[-6], 20), caption = "Matriz de datos para los modelos de venado cola blanca. Se presentan los primeros 20 renglones. Abreviatura: distancia al bebedero más cercano (DBMC), distancia al río más cercano (Rio), temperatura máxima (Tmax) y hora (HR).") %>% kable_styling(font_size = 4.5)
```

Antes de evaluar las variables mediante los modelos es necesario asegurarnos que estas no están correlacionadas entre sí, ya que la correlación de variables en los modelos lineales generalizados acarrea una menor presición y dificultades para probar hipótesis y realizar comparaciones, para asegurarnos de que no exista colinealidad se realiza una prueba de correlación mediante la función `cor()`:

```{r echo=TRUE, message=FALSE, warning=FALSE}
cor(Venado[(7:10)])
```

Si el valor es mayor a 0.7 las variables están correlacioandas y hay que eliminar una del análisis para obtener mejores resultados. En este caso la distancia a río está correlacionada con la dsitancia al bebedero más cercano, por lo que se elimina esta última variable. Una vez asegurado que las variables no están correlacionadas, el siguiente paso es estandarizarlas a media 0 y desviación estándar 1. Estos se aplica debido a que las variables se encuentran en distintas escalas, para esto se hace uso de la función `scale()` como:

```{r echo=TRUE, message=FALSE, warning=FALSE}
D_rio <- with(Venado, scale(Rio)) 
T_max <- with(Venado, scale(T_max)) 
HR <- with(Venado, scale(HR)) 
```

El número de visitas es una variable de conteo por lo que se puede emplear la distribución Poisson. Además, se emplean `offset` debido a que varió el número de ocasiones de muestreo en cada año. El modelo se ejecuta como:

```{r echo=TRUE, message=FALSE, warning=FALSE, linewidth=55}
Modelo1 <- with(Venado, glm(Visitas ~  Modelo + Año 
              + Rio + T_max * HR, offset = 
                log(Esfuerzo), family = poisson))
summary(Modelo1)
```

Se pueden correr tantos modelos se quieran, incluyendo las variables y combinaciones de variables que se quieran, siempre buscando que tengan sentido biológico y que sean sencillas de explicar. La manera de elegir el mejor modelo es escogiendo aquel que tenga el valor de Akaike (AIC) más bajo. 

Alternativamente, se puede emplear el proceso de "_Step backeard_" mediante la función `step()` como:

```{r echo=TRUE, message=FALSE, warning=FALSE, , message=FALSE, linewidth=55}
MejorModelo <- step(Modelo1)
summary(MejorModelo)
```

## Efecto de las variables

Una vez teniendo el mejor modelo, se puede obtener el efecto que tiene cada variable sobre las visitas a bebederos. Una manera sencilla de realizar esto es mediante el paquete `effects` [@effects2009] el cual proporciona gráficas de efecto de alguna variable en específico o de todas las variables del modelo (Figura \@ref(fig:h8)). Para esto se grafica la función `allEffects` para mostrar el efecto de todas las variables o `Effect` para graficar el efecto de una sola variable:

```
library(effects)
plot(allEffects(MejorModelo), main="")
```

```{r h8, echo=FALSE, message=FALSE, warning=FALSE, fig.align = 'center', fig.cap="Efecto de todas las variables sobre las visitas.", fig.height=10}
F1 <- load.image('figura.4.png')
plot(F1, axes = F)
```

## Sumario

A partir de la tasa de visita presentada en este capítulo para cuantificar el uso de puntos específicos del hábitat es posible hacer comparaciones y análisis que den peso estadístico a nuestro trabajo de investigación, de manera tal que podemos describir la estación que presentó una mayor tasa de visita, así como determinar si durante un año o temporada las visitas fueron mayores. Además con la aplicación de modelos lineales generalizados pueden describirse qué varaibles o condiciones tanto climáticas como antropogénicas están relacionadas con las visitas de los organismos al punto. Por último, cabe mencionar que estos análisis pueden complememntarse con otros análisis tales como patrones de actividad para describir los horarios en que ocurren las visitas.
