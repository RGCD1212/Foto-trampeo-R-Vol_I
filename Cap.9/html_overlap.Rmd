
# Análisis de actividad y traslape: `overlap`

### *Eva López-Tello* {-}

## Introducción

Actualmente por medio de las cámaras-trampa podemos describir los horarios de actividad de diferentes mamíferos medianos y grandes ya que al tomarse la foto queda grabada la fecha y hora en los metadatos. La frecuencia de foto-capturas por hora es un indicador de cuándo están activas o inactivas las especies, por medio de esto podemos definir si son nocturnas, diurnas, crepusculares o catemerales. 

Los patrones de actividad generalmente se grafican en histogramas o gráficas circulares utilizando las frecuencias. En el 2009 se propuso el uso de la densidad kernel para estimar el traslape entre dos horarios de actividad y en el 2014 se libera el paquete `overlap` [@meredith2017overlap]. Este paquete nos permite graficar los horarios de actividad de varias especies utilizando densidad kernel. También podemos estimar el coeficiente de traslape como medida no paramétrica que estima el área de coincidencia bajo dos curvas de densidad entre los patrones de dos especies o de una misma en diferentes sitios o épocas y estimar los intervalos de confianza [@Schmid2006]. 

Una de las ventajas de este paquete es que los registros no son agrupados en categorías de tiempo, se utilizan como muestras aleatorias de distribución continua modelando la curva a lo largo de las horas del día. Algunas de las cosas que se deben considerar antes de usar el paquete son: definir un ancho de banda adecuado ya que esto influye en la estimación del coeficiente de traslape (Delta o Dhat); preferentemente se debe contar con más de 75 registros independientes para una mejor estimación de Dhat. Al momento de interpretar los resultados debemos hacerlo con cautela porque el coeficiente de traslape es solo descriptivo, es decir que no se obtiene un valor de significancia (p). Si se quiere obtener un valor de "p"" debemos utilizar otros análisis estadísticos, por ejemplo estadística circular.

En este capítulo se presenta el proceso para obtener los horarios de actividad de una especie y estimar el traslape entre especies y/o individuos. Para este ejemplo se utilizará una base creada desde `camtrapR`, la cual contiene registros de 10 cámaras colocadas en la Reserva de la Biosfera Tehuacán-Cuicatlán en el año 2012.

## Descripción del paquete

El paquete `overlap` [@meredith2017overlap] se puede bajar desde:
<https://cran.r-project.org/web/packages/overlap/index.html>, y después cargar como:

```{r, echo=TRUE, message=FALSE, warning=FALSE}
library(overlap)
```

Una vez instalado el paquete, se debe crear una base en excel que contenga los registros de captura por hora. Esta base puede ser creada en Excel directamente o se puede utilizar la base creada desde `camtrapR`. 

Antes de cargar el archivo, primero se deben transformar todas las horas de registro a números, esto se hace desde excel de la siguiente forma:

1) Se agrega una nueva columna a lado de la columna `Time` (Figura \@ref(fig:o1)).

2) Se copian todas las horas en la nueva columna `Time_2` (Figura \@ref(fig:o2)).

3) Se cambia el formato de la columna a `general` y automáticamente todas las horas se transforman a números decimales (en un rango de 0 a 1), este es el formato que se requiere para utilizar el paquete por lo tanto es importante verificar que no haya celdas con 0 o mayores a 1. 

```{r o1, echo=FALSE, out.width="95%", message=FALSE, warning=FALSE, fig.align='center', fig.cap="Datos iniciales del foto-trampeo."}
library(imager)
F1 <- load.image ("Figura_1.JPG")
plot (F1, axes = F)
```

```{r o2, echo=FALSE, out.width="95%", message=FALSE, warning=FALSE, fig.align='center', fig.cap="En la tabla se han agregado columnas nuevas."}
F2 <- load.image("Figura_2.JPG")
plot(F2, axes = F)
```

Una vez que se guardan los cambios en la base con formato *.csv, se pide a R que lea la tabla:

```{r, echo=TRUE, message=FALSE, warning=FALSE}
actividad_RBTC <- read.csv("tabla registros.csv", 
     header = T)
```

## Pasos principales

Una vez se cargó la tabla, observamos las especies y el número de registros independientes obtenidos para cada una: 

```{r, echo=TRUE, message=FALSE, warning=FALSE, linewidth=55}
summary(actividad_RBTC$Species)
```

Esto permite elegir las especies que tienen el número de registros necesarios para poder describir su horario de actividad. Algunos autores sugieren que con 11 registros se puede describir la actividad. Sin embargo, actualmente no existen trabajos que evaluen cuantos registros se requieren para tener una descripción confiable, por lo tanto se deben tomar con cautela los resultados si se tienen pocos registros. En este paquete se sugiere tener una muestra de 50 o más registros para poder obtener una mejor estimación de `Dhat`.

Una vez seleccionadas las especies con las que se va a trabajar, se procede a convertir los números decimales a radianes:

```{r, echo=TRUE, message=FALSE, warning=FALSE}
hora_radianes_RBTC <- actividad_RBTC$Time_2 * 2 * pi
```

Después se extraen los datos de las especies seleccionadas, para este ejemplo se eligieron solo las que tuvieron más de 50 registros.

```{r, echo=TRUE, message=FALSE, warning=FALSE}
conejo_RBTC <- hora_radianes_RBTC [
  actividad_RBTC$Species == "Conejo"]

lince_RBTC <- hora_radianes_RBTC [
  actividad_RBTC$Species == "Lince"]

zorra_RBTC <- hora_radianes_RBTC[
  actividad_RBTC$Species == "Zorra"]

venado_RBTC <- hora_radianes_RBTC [
  actividad_RBTC$Species == "Venado"]
```

Si se quieren comparar datos entre años, épocas y/o sexos de una misma especie, se extraen los datos de la siguiente forma:

```
venado_RBTC_2012 <- hora_radianes_RBTC [
actividad_RBTC$Species == "Venado" & 
actividad_RBTC == 2012]

venado_RBTC_2013 <- hora_radianes_RBTC [
actividad_RBTC$Species == "Venado" & 
actividad_RBTC == 2013]
```

## Gráficas de actividad

Una vez extraídos los datos de cada especie se puede graficar el horario de actividad de cada una por separado (Figura \@ref(fig:o3)). 

```{r o3, echo=TRUE, fig.align='center', fig.cap="Patrón de actividad de dos especies", message=FALSE, warning=FALSE, fig.height=9}
par(mfcol = c(2,1), mar = c(5,1,1,1))
densityPlot(conejo_RBTC, xscale = 24, rug = T, extend = 
"lightgray", main = "Conejo", xlab = "Hora", ylab = 
"Densidad", bty = "L")

densityPlot(lince_RBTC, xscale = 24, rug = T, extend = 
"lightgray", main = "Lince", xlab = "Hora", ylab= 
"Densidad", bty = "L") 
```

Alternativamente, se pueden incluir todas las especies en la misma gráfica como:

```
densityPlot(conejo_RBTC, xscale = 24, 
  extend = NULL, main = " ", xlab = "Hora", 
  ylab = "Densidad", bty = "L", col = "black", 
  lty = 1)
densityPlot(lince_RBTC, add = TRUE, 
  col = "royalblue4", lty = 2) 
densityPlot(zorra_RBTC, add = TRUE, 
  col = "darkgreen", lty = 3) 
densityPlot(venado_RBTC, add = TRUE, 
  col = "red2", lty = 4) 
legend("topright", inset= c(0,0),
  title = "Especies", c("Conejo", "Lince", 
  "Zorra", "Venado"), lty = 1:4, 
col = c("black", "royalblue4", "darkgreen", 
"red2"), bty = "n")
```

## Estimación de traslape

El coeficiente de traslape (`Dhat`) es una medida no paramétrica que nos permite comparar el horario de actividad entre especies, sexos, edades, épocas o sitios de estudio. El valor de delta va de 0 a 1, donde 1 = actividad igual y 0 = actividad diferente. Se recomienda consultar a Schmid y Schmidt (2006) y Ridout y Linkie (2009).

El paquete `overlap` estima tres Dhat: 1, 4 y 5, para seleccionar el mejor estimador se debe tomar en cuenta el tamaño de la muestra más pequeña que se va a comparar. Cuando la muestra es menor a 50 registros se utiliza Dhat1 y si es mayor a 75 se utiliza Dhat4, los autores recomiendan no utilizar Dhat5 ya que es muy variable dependiendo del número de registros utilizados.

Para este ejemplo se va a comparar el patrón de actividad de conejos (presa) y zorras (predador):

```
conejo_RBTC
zorra_RBTC
```

Para decidir que Dhta utilizar podemos pedir a R que nos muestre el número mínimo de registros obtenidos con la función:

```{r, echo=TRUE, message=FALSE, warning=FALSE}
min(length(conejo_RBTC), length(zorra_RBTC))
```

En este caso tomaremos como estimador a Dhat4 ya que se tienen más de 75 registros de la muestra más pequeña. Una vez que ya se sabe que Dhat se utilizará se procede a su estimación: 

```{r, echo=TRUE, message=FALSE, warning=FALSE}
conejo_zorra_delta <- overlapEst(conejo_RBTC, 
           zorra_RBTC)
conejo_zorra_delta
```

Después se puede graficar el horario de actividad de las dos especies y su traslape con la función:

```{r, echo=TRUE, fig.height=5, message=FALSE, warning=FALSE, fig.align='center', fig.cap= "En la gráfica la parte sombreada en gris representa los horarios en los cuales se traslapa la actividad de las dos especies."}
overlapPlot(conejo_RBTC, zorra_RBTC, main = " ", 
  linecol = c("black", "darkgreen"), lty = c(1,3), 
  bty = "L", xlab = "Hora", ylab = "Densidad")
legend("topright", inset = c(0,0), title = "Especies", 
  c("Conejo", "Zorra"), lty= c(1,3), 
  col = c("gray25", "seagreen"), bty = "n")
```

## Intervalos de confianza

También se pueden obtener los intervalos de confianza al 95% por medio de remuestreo. Para esto es necesario seguir tres pasos:

1) Se utiliza la función `resample` para crear una matriz de remuestreo para cada conjunto de datos

```{r, echo=TRUE, message=FALSE, warning=FALSE}
conejo_remuestreo <- resample(conejo_RBTC, 1000)
zorra_remuestreo <- resample(zorra_RBTC, 1000)
```

Los autores del paquete recomiendan que se utilice un remuestreo mínimo de 1000.

2) Se usa `bootEst` para estimar el valor de Dhat de cada dato remuestreado

```{r, echo=TRUE, message=FALSE, warning=FALSE}
conejo_zorra_delta_remuestreo <- bootEst(
  conejo_remuestreo, zorra_remuestreo, adjust = 
    c(NA, 1, NA))
```

El valor de `adjust` dependerá del Dhat seleccionado, los autores del paquete sugieren que se utilice 0.8 para Dhat1, 1 para Dhat4 y 4 para Dhat5. Por ejemplo, si utilizamos Dhat1 entonces queda `adjust= c(0.8, NA, NA)`.   

Una vez estimados todos los valores de Dhat4 se obtiene el promedio con la función:

```{r, echo=TRUE, message=FALSE, warning=FALSE}
conejo_zorra_delta_promedio <-
  colMeans(conejo_zorra_delta_remuestreo)
conejo_zorra_delta_promedio
```

3) Se obtienen los intervalos de confianza de la siguiente forma:

```{r, echo=TRUE, message=FALSE, warning=FALSE}
conejo_zorra_delta_remuestreo2 <- 
  conejo_zorra_delta_remuestreo[, 2]
bootCI(conejo_zorra_delta [2], 
  conejo_zorra_delta_remuestreo2)
```

Note que para obtener los intervalos de confianza (`bootCI`) se utiliza el objeto `conejo_zorra_delta` que contiene el valor de Dhat estimado para los registros obtenidos y el objeto `conejo_zorra_delta_remuestreo2` que contiene los valores de Dhat estimado para los datos remuestreados.  

## Sumario

El paquete `overlap` es eficiente para graficar los horarios de actividad y  estimar el traslape. Algunas de sus ventajas son que se puede utilizar la tabla de registros creada desde camtrap o Excel, no es necesario agrupar el número de registros por intervalos de hora, se pueden estimar intervalos de confianza para el traslape y para editar las gráficas se pueden utilizar argumentos de la función plot (`col, lty, lwd, xlab, ylab` y/o `main`). Algunas de las limitaciones del paquete son que se requiere (preferentemente) una muestra de 75 o más registros, es necesario establecer el ancho de banda adecuado para tener una estimación confiable del coeficiente de traslape (Dhat). Por último el coeficiente de traslape solo es descriptivo ya que no se obtiene un valor de significancia estadístico, por lo que es necesario complementar con otros análisis. 


